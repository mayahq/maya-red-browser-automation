<script type='text/javascript'>
    RED.nodes.registerType("maya-browser-type", {
        category: "Maya Browser Automation",
        color: "#8BBDD9",
        defaults: {
            name: {
                value: ""
            },
            isProfileConfigNode: {
                value: false
            },
            selector: {
                value: ""
            },
            payloadTypeselector: {
                value: "str"
            },
            timeout: {
                value: "2000"
            },
            payloadTypetimeout: {
                value: "num"
            },
            tabId: {
                value: ""
            },
            payloadTypetabId: {
                value: "str"
            },
            index: {
                value: "0"
            },
            payloadTypeindex: {
                value: "num"
            },
            session: {
                value: "",
                type: "maya-browser-connect"
            },
            content: {
                value: ""
            },
            payloadTypecontent: {
                value: "str"
            },
        },
        inputs: 1,
        outputs: 1,
        icon: "fa-file-code-o.png",
        label: function() {
            return this.name || "Type"
        },
        paletteLabel: "Type",
        exportable: true,
        oneditprepare: function() {
            if (this.payloadTypeselector === null) {
                if (this.selector === "") {
                    this.payloadTypeselector = "date"
                } else {
                    this.payloadTypeselector = "str"
                }
            } else if (this.payloadTypeselector === 'string' || this.payloadTypeselector === 'none') {
                this.payloadTypeselector = "str"
            }

            $("#node-input-payloadTypeselector").val(this.payloadTypeselector)
            $("#node-input-selector").typedInput({
                default: "str",
                typeField: $("#node-input-payloadTypeselector"),
                types: ["msg", "global", "flow", "str"]
            })
            $("#node-input-selector").typedInput("type", this.payloadTypeselector)

            if (this.payloadTypetimeout === null) {
                if (this.timeout === "") {
                    this.payloadTypetimeout = "date"
                } else {
                    this.payloadTypetimeout = "num"
                }
            } else if (this.payloadTypetimeout === 'string' || this.payloadTypetimeout === 'none') {
                this.payloadTypetimeout = "num"
            }

            $("#node-input-payloadTypetimeout").val(this.payloadTypetimeout)
            $("#node-input-timeout").typedInput({
                default: "num",
                typeField: $("#node-input-payloadTypetimeout"),
                types: ["msg", "global", "flow", "num"]
            })
            $("#node-input-timeout").typedInput("type", this.payloadTypetimeout)

            if (this.payloadTypetabId === null) {
                if (this.tabId === "") {
                    this.payloadTypetabId = "date"
                } else {
                    this.payloadTypetabId = "str"
                }
            } else if (this.payloadTypetabId === 'string' || this.payloadTypetabId === 'none') {
                this.payloadTypetabId = "str"
            }

            $("#node-input-payloadTypetabId").val(this.payloadTypetabId)
            $("#node-input-tabId").typedInput({
                default: "str",
                typeField: $("#node-input-payloadTypetabId"),
                types: ["msg", "global", "flow", "str"]
            })
            $("#node-input-tabId").typedInput("type", this.payloadTypetabId)

            if (this.payloadTypeindex === null) {
                if (this.index === "") {
                    this.payloadTypeindex = "date"
                } else {
                    this.payloadTypeindex = "num"
                }
            } else if (this.payloadTypeindex === 'string' || this.payloadTypeindex === 'none') {
                this.payloadTypeindex = "num"
            }

            $("#node-input-payloadTypeindex").val(this.payloadTypeindex)
            $("#node-input-index").typedInput({
                default: "num",
                typeField: $("#node-input-payloadTypeindex"),
                types: ["msg", "global", "flow", "num"]
            })
            $("#node-input-index").typedInput("type", this.payloadTypeindex)

            if (this.payloadTypecontent === null) {
                if (this.content === "") {
                    this.payloadTypecontent = "date"
                } else {
                    this.payloadTypecontent = "str"
                }
            } else if (this.payloadTypecontent === 'string' || this.payloadTypecontent === 'none') {
                this.payloadTypecontent = "str"
            }

            $("#node-input-payloadTypecontent").val(this.payloadTypecontent)
            $("#node-input-content").typedInput({
                default: "str",
                typeField: $("#node-input-payloadTypecontent"),
                types: ["msg", "global", "flow", "str"]
            })
            $("#node-input-content").typedInput("type", this.payloadTypecontent)

        },
        oneditsave: function() {},
        oneditcancel: function() {},
        oneditdelete: function() {},
        oneditresize: function() {},
        onpaletteadd: function() {},
        onpaletteremove: function() {}
    });
</script>

<script type="text/html" data-template-name="maya-browser-type">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" style="width:70%;" placeholder="Name" />
    </div>
    <div class="form-row">
        <label for="node-input-selector">selector</label>
        <input type="text" id="node-input-selector"></input>
        <input type="hidden" id="node-input-payloadTypeselector">
    </div>
    <div class="form-row">
        <label for="node-input-timeout">timeout</label>
        <input type="text" id="node-input-timeout"></input>
        <input type="hidden" id="node-input-payloadTypetimeout">
    </div>
    <div class="form-row">
        <label for="node-input-tabId">tabId</label>
        <input type="text" id="node-input-tabId"></input>
        <input type="hidden" id="node-input-payloadTypetabId">
    </div>
    <div class="form-row">
        <label for="node-input-index">index</label>
        <input type="text" id="node-input-index"></input>
        <input type="hidden" id="node-input-payloadTypeindex">
    </div>
    <div class="form-row">
        <label for="node-input-session">session</label>
        <input type="text" id="node-input-session"></input>
    </div>
    <div class="form-row">
        <label for="node-input-content">content</label>
        <input type="text" id="node-input-content"></input>
        <input type="hidden" id="node-input-payloadTypecontent">
    </div>
</script>

<script type="text/html" data-help-name="maya-browser-type">
    <h2>Description</h2>
    <p>Type in a specified element on a given (not necessarily open) browser tab.</p>
    <br>

    <h2>Config</h2>
    <dl class="message-properties">

        <dt>selector<span class="property-type">string</span></dt>
        <dd>
            The xpath for the element to type inside. We recommend watching <a href='https://www.youtube.com/watch?v=NhG__BL8zFo'>this video</a> to learn
            more about xpaths (it's slightly long, but its worth it).
        </dd>

        <dt>timeout <span class="property-type">number</span></dt>
        <dd>
            The amount of time in milliseconds that the node will wait for the target element to load in page. Whenever the element is
            loaded, the type action is performed immediately. If it doesn't load within this time period, the node will error out.
        </dd>

        <dt>tabId <span class="property-type">number</span></dt>
        <dd>
            The <code>id</code> of the tab inside which this action is to be performed.
        </dd>

        <dt>index <span class="property-type">number</span></dt>
        <dd>
            The index of the element to type in, in case your xpath query resolves to multiple elements. If sure that your query
            will always resolve to a unique element, just set this to 0.
        </dd>

        <dt>session <span class="property-type">config</span></dt>
        <dd>
            Holds the encryption keys used by Maya to securely talk to your browser.
        </dd>

        <dt>content <span class="property-type">string</span></dt>
        <dd>
            The actual content to type in the selected element.
        </dd>
    </dl>
    <br>


    <h2>Outputs</h2>
    <p>
        This node does not set any properties on the <code>msg</code> object in case of successful execution.
    </p>
    <br>

    <h2>On error</h2>
    <p>
        The node will set the below-mentioned properties on the <code>msg</code> object, when there is an error
    </p>
    <dl class="message-properties">

        <dt>isError<span class="property-type">boolean</span></dt>
        <dd>Set to true if the type operation failed for whatever reason. This property might not be set at all in case of no error.</dd>

        <dt>error <span class="property-type">object</span></dt>
        <dd>Contains information about the error that occured</dd>

    </dl>
</script>